(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6cf9bd05"],{"0feb":function(e,t,r){"use strict";var n=r("365c"),s={get:function(e){return n["a"].get("permission",{params:{id:e}})},add:function(e){return n["a"].post("permission",e)},update:function(e){return n["a"].put("permission",e)},delete:function(e){return n["a"].delete("permission",{params:{id:e}})},deleteAll:function(e){return n["a"].delete("permission/deleteall",{params:{ids:e}})},getPageList:function(e){return n["a"].get("permission/pagelist",{params:e})},getList:function(e){return n["a"].get("permission/list",{params:e})},getPermissionIdsByRoleId:function(e){return n["a"].get("permission/permissionidsbyroleid",{params:{roleId:e}})},getPermissionListByUserId:function(e){return n["a"].get("permission/permissionlistbyuserid",{params:{userId:e}})},assignPermission:function(e){return n["a"].post("permission/assign",e)}};t["a"]=s},"365c":function(e,t,r){"use strict";r("a481");var n=r("bc3a"),s=r.n(n),o=r("3786"),i=r("41cb"),a=r("c0d6"),c=r("a026"),u="",l={baseURL:u+"/api"},m=s.a.create(l),f=s.a.create(),d=a["a"];m.interceptors.request.use((function(e){var t=new Date,r=new Date(Date.parse(d.state.tokenExpire));return d.state.token&&t<r&&d.state.tokenExpire&&(e.headers.Authorization="Bearer "+d.state.token),p(),e}),(function(e){return Promise.reject(e)})),m.interceptors.response.use((function(e){return e}),(function(e){var t=e.config;if("ECONNABORTED"==e.code&&-1!=e.message.indexOf("timeout")&&!t._retry)return c["default"].prototype.$message({message:"请求超时！",type:"error"}),t._retry=!0,null;if(e.response){if(401==e.response.status){var r=new Date,n=new Date(Date.parse(window.localStorage.refreshtime));if(window.localStorage.refreshtime&&r<=n)return o["a"].refreshToken({token:window.localStorage.Token}).then((function(t){if(t.success){c["default"].prototype.$message({message:"refreshToken success! loading data...",type:"success"}),a["a"].commit("saveToken",t.token);var r=new Date,n=new Date(r.setSeconds(r.getSeconds()+t.expires_in));return a["a"].commit("saveTokenExpire",n),e.config.__isRetryRequest=!0,e.config.headers.Authorization="Bearer "+t.token,s()(e.config)}g()}));g()}if(403==e.response.status)return c["default"].prototype.$message({message:"失败！该操作无权限",type:"error"}),null}return""}));var p=function(){var e=new Date,t=window.localStorage.refreshtime?new Date(window.localStorage.refreshtime):new Date(-1),r=new Date(Date.parse(window.localStorage.TokenExpire)),n=1;t>=e?(t=e>r?e:r,t.setMinutes(t.getMinutes()+n),window.localStorage.refreshtime=t):window.localStorage.refreshtime=new Date(-1)},g=function(){a["a"].commit("saveToken",""),a["a"].commit("saveTokenExpire",""),a["a"].commit("saveTagsData",""),window.localStorage.removeItem("user"),window.localStorage.removeItem("NavigationBar"),i["a"].replace({path:"/login",query:{redirect:i["a"].currentRoute.fullPath}}),window.location.reload()},h={instance:function(){return m},baseInstance:function(){return f},get:function(e,t){return new Promise((function(r,n){m.get(e,t).then((function(e){r(e)})).catch((function(e){n(e)}))}))},post:function(e,t){return new Promise((function(r,n){m.post(e,t).then((function(e){r(e)})).catch((function(e){n(e)}))}))},put:function(e,t){return new Promise((function(r,n){m.put(e,t).then((function(e){r(e)})).catch((function(e){n(e)}))}))},delete:function(e,t){return new Promise((function(r,n){m.delete(e,t).then((function(e){r(e)})).catch((function(e){n(e)}))}))}};t["a"]=h},3786:function(e,t,r){"use strict";var n=r("365c"),s={getToken:function(e){return n["a"].get("auth/Token",e)},refreshToken:function(e){return n["a"].get("auth/RefreshToken",e)}};t["a"]=s},"816b":function(e,t,r){"use strict";var n=r("365c"),s={get:function(e){return n["a"].get("module",{params:{id:e}})},add:function(e){return n["a"].post("module",e)},update:function(e){return n["a"].put("module",e)},delete:function(e){return n["a"].delete("module",{params:{id:e}})},deleteAll:function(e){return n["a"].delete("module/deleteall",{params:{ids:e}})},getPageList:function(e){return n["a"].get("module/pagelist",{params:e})},getList:function(e){return n["a"].get("module/list",{params:e})}};t["a"]=s},b772:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("div",{staticClass:"crumbs"},[r("el-breadcrumb",{attrs:{separator:"/"}},[r("el-breadcrumb-item",[r("i",{staticClass:"el-icon-lx-calendar"}),e._v(" 菜单管理")]),r("el-breadcrumb-item",[e._v("添加/编辑菜单")])],1)],1),r("div",{staticClass:"container"},[r("div",{staticClass:"form-box"},[r("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"150px"}},[r("el-form-item",{attrs:{label:"菜单/按钮名称",prop:"Name"}},[r("el-input",{attrs:{"auto-complete":"off"},model:{value:e.form.Name,callback:function(t){e.$set(e.form,"Name",t)},expression:"form.Name"}})],1),r("el-form-item",{attrs:{label:"路由地址",prop:"Code"}},[r("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"如果是导航条且无路由，请填‘-’字符，如果是按钮，请输入空格即可",placement:"top-start"}},[r("el-input",{attrs:{"auto-complete":"off"},model:{value:e.form.Code,callback:function(t){e.$set(e.form,"Code",t)},expression:"form.Code"}})],1)],1),r("el-form-item",{attrs:{label:"图标"}},[r("el-input",{model:{value:e.form.Icon,callback:function(t){e.$set(e.form,"Icon",t)},expression:"form.Icon"}})],1),r("el-form-item",{attrs:{label:"方法"}},[r("el-input",{model:{value:e.form.Action,callback:function(t){e.$set(e.form,"Action",t)},expression:"form.Action"}})],1),r("el-form-item",{attrs:{prop:"ParentId",label:"父级菜单",width:""}},[r("el-cascader",{staticStyle:{width:"400px"},attrs:{options:e.permissionOptions,props:{checkStrictly:!0},clearable:""},model:{value:e.parentIds,callback:function(t){e.parentIds=t},expression:"parentIds"}})],1),r("el-form-item",{attrs:{prop:"ModuleId",label:"API接口",width:""}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择API"},model:{value:e.form.ModuleId,callback:function(t){e.$set(e.form,"ModuleId",t)},expression:"form.ModuleId"}},[r("el-option",{key:0,attrs:{value:0,label:"无"}}),e._l(e.moduleList,(function(t){return r("el-option",{key:t.Id,attrs:{value:t.Id,label:t.LinkUrl}},[r("span",{staticStyle:{float:"left"}},[e._v(e._s(t.LinkUrl))]),r("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(t.Name))])])}))],2)],1),r("el-form-item",{attrs:{label:"描述",prop:"Description"}},[r("el-input",{attrs:{"auto-complete":"off"},model:{value:e.form.Description,callback:function(t){e.$set(e.form,"Description",t)},expression:"form.Description"}})],1),r("el-form-item",{attrs:{label:"是否启用"}},[r("el-switch",{model:{value:e.form.Enabled,callback:function(t){e.$set(e.form,"Enabled",t)},expression:"form.Enabled"}})],1),r("el-form-item",{attrs:{prop:"IsButton",label:"是否按钮",width:"",sortable:""}},[r("el-switch",{model:{value:e.form.IsButton,callback:function(t){e.$set(e.form,"IsButton",t)},expression:"form.IsButton"}})],1),r("el-form-item",{attrs:{prop:"IsHide",label:"隐藏菜单",width:"",sortable:""}},[r("el-switch",{model:{value:e.form.IsHide,callback:function(t){e.$set(e.form,"IsHide",t)},expression:"form.IsHide"}})],1),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("保 存")])],1)],1)],1)])])},s=[],o=(r("ac6a"),r("55dd"),r("7514"),r("0feb")),i=r("816b"),a={name:"addOrEdit",data:function(){return{form:{Name:"",Code:"",Icon:"",Action:"",Description:"",Enabled:!1,IsButton:!1,IsHide:!1},id:-1,rules:{Name:[{required:!0,message:"请输入菜单/按钮名称",trigger:"blur"}],parentIds:[{required:!0,message:"请输入菜单/按钮名称",trigger:"blur"}]},permissionList:[],permissionOptions:[],moduleList:[],parentIds:[],tempIds:[]}},computed:{},methods:{init:function(){var e=this;this.getPermissionList().then((function(t){e.id>0&&e.getPermission(e.id)})),this.getModuleList()},getPermission:function(e){var t=this;o["a"].get(e).then((function(e){var r=e.data;if(r.success){if(t.form=r.data,t.tempIds.push(t.form.ParentId),t.form.ParentId>0){var n=t.permissionList.find((function(e){return e.Id==t.form.ParentId}));if(!n)return;t.tempIds.push(n.ParentId),t.group(n),t.tempIds.sort((function(e,t){return e-t})),t.parentIds=t.tempIds}}else t.$message({message:"获取菜单信息失败",type:"error"})})).catch((function(e){t.$message({message:"获取菜单信息失败",type:"error"})}))},group:function(e){var t=this.permissionList.find((function(t){return t.Id==e.ParentId}));t&&(this.tempIds.push(t.ParentId),this.group(t))},getModuleList:function(){var e=this;i["a"].getList({}).then((function(t){var r=t.data;r.success?e.moduleList=t.data.data:e.$message({message:r.message,type:"error"})})).catch((function(t){e.$message({message:"加载接口列表失败",type:"error"})}))},getPermissionList:function(){var e=this;return new Promise((function(t,r){o["a"].getList({}).then((function(r){var n=r.data;if(n.success){var s=[{value:0,label:"根节点",children:[]}];if(e.permissionList=n.data,0==e.permissionList.length)return void(e.permissionOptions=s);e.permissionOptions=e.permissionList.filter((function(e){return 0==e.ParentId||null==e.ParentId})).map((function(e){return{value:e.Id,label:e.Name}})),e.permissionOptions.forEach((function(t,r){e.groupPermission(t)})),s[0].children=e.permissionOptions,e.permissionOptions=s}else e.$message({message:n.message,type:"error"});t()})).catch((function(t){e.$message({message:"加载菜单列表失败",type:"error"})}))}))},groupPermission:function(e){var t=this,r=this.permissionList.filter((function(t){return t.ParentId==e.value})).map((function(e){return{value:e.Id,label:e.Name}}));if(0==r.length)return null;e.children=r,e.children.forEach((function(e,r){t.groupPermission(e)}))},onSubmit:function(){var e=this;e.$refs["form"].validate((function(t){t&&(e.form.ParentId=e.parentIds[e.parentIds.length-1],e.id>0?(e.form.Id=e.id,o["a"].update(e.form).then((function(t){console.log(t);var r=t.data;r.success&&e.$message({message:"保存成功",type:"success"})})).catch((function(t){e.$message({message:t,type:"error"}),console.log(t)}))):o["a"].add(e.form).then((function(t){console.log(t);var r=t.data;r.success&&e.$message({message:"保存成功",type:"success"})})).catch((function(t){e.$message({message:t,type:"error"}),console.log(t)})))}))}},created:function(){var e=this.$route.params.id;e&&(this.id=parseInt(e)),this.init()}},c=a,u=r("2877"),l=Object(u["a"])(c,n,s,!1,null,null,null);t["default"]=l.exports}}]);