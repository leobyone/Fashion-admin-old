(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a44bb650"],{"365c":function(e,t,a){"use strict";a("a481");var r=a("bc3a"),s=a.n(r),o=a("3786"),n=a("41cb"),i=a("c0d6"),l=a("a026"),u="",c={baseURL:u+"/api"},m=s.a.create(c),f=s.a.create(),d=i["a"];m.interceptors.request.use((function(e){var t=new Date,a=new Date(Date.parse(d.state.tokenExpire));return d.state.token&&t<a&&d.state.tokenExpire&&(e.headers.Authorization="Bearer "+d.state.token),p(),e}),(function(e){return Promise.reject(e)})),m.interceptors.response.use((function(e){return e}),(function(e){var t=e.config;if("ECONNABORTED"==e.code&&-1!=e.message.indexOf("timeout")&&!t._retry)return l["default"].prototype.$message({message:"请求超时！",type:"error"}),t._retry=!0,null;if(e.response){if(401==e.response.status){var a=new Date,r=new Date(Date.parse(window.localStorage.refreshtime));if(window.localStorage.refreshtime&&a<=r)return o["a"].refreshToken({token:window.localStorage.Token}).then((function(t){if(t.success){l["default"].prototype.$message({message:"refreshToken success! loading data...",type:"success"}),i["a"].commit("saveToken",t.token);var a=new Date,r=new Date(a.setSeconds(a.getSeconds()+t.expires_in));return i["a"].commit("saveTokenExpire",r),e.config.__isRetryRequest=!0,e.config.headers.Authorization="Bearer "+t.token,s()(e.config)}g()}));g()}if(403==e.response.status)return l["default"].prototype.$message({message:"失败！该操作无权限",type:"error"}),null}return""}));var p=function(){var e=new Date,t=window.localStorage.refreshtime?new Date(window.localStorage.refreshtime):new Date(-1),a=new Date(Date.parse(window.localStorage.TokenExpire)),r=1;t>=e?(t=e>a?e:a,t.setMinutes(t.getMinutes()+r),window.localStorage.refreshtime=t):window.localStorage.refreshtime=new Date(-1)},g=function(){i["a"].commit("saveToken",""),i["a"].commit("saveTokenExpire",""),i["a"].commit("saveTagsData",""),window.localStorage.removeItem("user"),window.localStorage.removeItem("NavigationBar"),n["a"].replace({path:"/login",query:{redirect:n["a"].currentRoute.fullPath}}),window.location.reload()},h={instance:function(){return m},baseInstance:function(){return f},get:function(e,t){return new Promise((function(a,r){m.get(e,t).then((function(e){a(e)})).catch((function(e){r(e)}))}))},post:function(e,t){return new Promise((function(a,r){m.post(e,t).then((function(e){a(e)})).catch((function(e){r(e)}))}))},put:function(e,t){return new Promise((function(a,r){m.put(e,t).then((function(e){a(e)})).catch((function(e){r(e)}))}))},delete:function(e,t){return new Promise((function(a,r){m.delete(e,t).then((function(e){a(e)})).catch((function(e){r(e)}))}))}};t["a"]=h},3786:function(e,t,a){"use strict";var r=a("365c"),s={getToken:function(e){return r["a"].get("auth/Token",e)},refreshToken:function(e){return r["a"].get("auth/RefreshToken",e)}};t["a"]=s},39345:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"crumbs"},[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",[a("i",{staticClass:"el-icon-lx-calendar"}),e._v(" 用户管理")]),a("el-breadcrumb-item",[e._v("添加/编辑用户")])],1)],1),a("div",{staticClass:"container"},[a("div",{staticClass:"form-box"},[a("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"150px"}},[a("el-form-item",{attrs:{label:"登录名",prop:"LoginName"}},[a("el-input",{model:{value:e.form.LoginName,callback:function(t){e.$set(e.form,"LoginName",t)},expression:"form.LoginName"}})],1),a("el-form-item",{attrs:{label:"头像",prop:"Avatar"}},[a("el-upload",{staticClass:"avatar-uploader",attrs:{action:e.uploadUrl,"show-file-list":!1,"before-upload":e.beforeAvatarUpload,"http-request":e.uploadImage}},[e.form.Avatar?a("img",{staticClass:"avatar",attrs:{src:e.form.Avatar}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),0===e.id?a("el-form-item",{attrs:{label:"密码",prop:"Password"}},[a("el-input",{attrs:{"show-password":"","auto-complete":"off"},model:{value:e.form.Password,callback:function(t){e.$set(e.form,"Password",t)},expression:"form.Password"}})],1):e._e(),a("el-form-item",{attrs:{label:"用户角色",prop:"RoleIds"}},[a("el-select",{attrs:{multiple:"",placeholder:"请选择"},model:{value:e.roleIds,callback:function(t){e.roleIds=t},expression:"roleIds"}},e._l(e.roleList,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:"姓名"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.form.RealName,callback:function(t){e.$set(e.form,"RealName",t)},expression:"form.RealName"}})],1),a("el-form-item",{attrs:{label:"性别"}},[a("el-radio-group",{model:{value:e.form.Sex,callback:function(t){e.$set(e.form,"Sex",t)},expression:"form.Sex"}},[a("el-radio",{staticClass:"radio",attrs:{label:1}},[e._v("男")]),a("el-radio",{staticClass:"radio",attrs:{label:0}},[e._v("女")])],1)],1),a("el-form-item",{attrs:{label:"年龄"}},[a("el-input-number",{attrs:{min:0,max:100},model:{value:e.form.Age,callback:function(t){e.$set(e.form,"Age",t)},expression:"form.Age"}})],1),a("el-form-item",{attrs:{label:"生日"}},[a("el-date-picker",{attrs:{type:"date",placeholder:"选择日期"},model:{value:e.form.Birthday,callback:function(t){e.$set(e.form,"Birthday",t)},expression:"form.Birthday"}})],1),a("el-form-item",{attrs:{label:"地址"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.form.Address,callback:function(t){e.$set(e.form,"Address",t)},expression:"form.Address"}})],1),a("el-form-item",{attrs:{label:"是否启用"}},[a("el-switch",{model:{value:e.status,callback:function(t){e.status=t},expression:"status"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("保 存")])],1)],1)],1)])])},s=[],o=(a("28a5"),a("c24f")),n=a("cc5e"),i=a("365c"),l={uploadImg:function(e,t){return i["a"].post("upload/upload-image",e,t)}},u=l,c={name:"addOrEdit",data:function(){return{roleIds:[],roleList:[],status:!0,form:{LoginName:"",RealName:"",Password:"",Status:0,Age:0,Sex:0,Birthday:"",Address:"",Avatar:""},id:-1,rules:{LoginName:[{required:!0,message:"请输入登录名",trigger:"blur"}],Password:[]},uploadUrl:"/api/upload/upload-image"}},computed:{},methods:{init:function(){this.id>0&&this.getUser(this.id),this.getRoleList()},getUser:function(e){var t=this;o["a"].get(e).then((function(e){var a=e.data;a.success?(t.form=a.data,t.status=0!=t.form.Status,t.form.RoleIds&&(t.roleIds=t.form.RoleIds.split(",").map((function(e){return parseInt(e)})))):t.$message({message:"获取用户信息失败",type:"error"})})).catch((function(e){t.$message({message:"获取用户信息失败",type:"error"})}))},getRoleList:function(){var e=this;return new Promise((function(t,a){n["a"].getList({}).then((function(t){var a=t.data;a.success?e.roleList=a.data.map((function(e){return{value:e.Id,label:e.Name}})):e.$message({message:"加载角色列表失败",type:"error"})})).catch((function(t){e.$message({message:"加载角色列表失败",type:"error"})}))}))},beforeAvatarUpload:function(e){var t="image/jpeg"===e.type||"image/jpg"===e.type||"image/png"===e.type||"image/gif"===e.type,a=e.size/1024/1024<2;return t||this.$message.error("上传头像图片只能是 JPG 格式!"),a||this.$message.error("上传头像图片大小不能超过 2MB!"),t&&a},uploadImage:function(e){var t=this,a=new FormData;a.append("file",e.file);var r={headers:{"Content-Type":"multipart/form-data"}};u.uploadImg(a,r).then((function(e){var a=e.data;a.success?t.form.Avatar=a.data:t.$message.error("上传失败!")}))},onSubmit:function(){var e=this;e.$refs["form"].validate((function(t){t&&(e.form.RoleIds=e.roleIds.join(","),e.form.Status=e.status?1:0,e.id>0?(e.form.Id=e.id,o["a"].update(e.form).then((function(t){var a=t.data;a.success&&e.$message({message:"保存成功",type:"success"})})).catch((function(t){e.$message({message:t,type:"error"})}))):o["a"].add(e.form).then((function(t){var a=t.data;a.success&&e.$message({message:"保存成功",type:"success"})})).catch((function(t){e.$message({message:t,type:"error"})})))}))}},created:function(){var e=this.$route.params.id;e>=0&&(this.id=parseInt(e)),0===this.id&&this.rules.Password.push({required:!0,message:"请输入密码",trigger:"blur"}),this.init()}},m=c,f=(a("b9a5"),a("2877")),d=Object(f["a"])(m,r,s,!1,null,"e901f882",null);t["default"]=d.exports},"88ea":function(e,t,a){},b9a5:function(e,t,a){"use strict";var r=a("88ea"),s=a.n(r);s.a},c24f:function(e,t,a){"use strict";var r=a("365c"),s={getUserByToken:function(e){return r["a"].get("user/getbytoken",{params:{token:e}})},get:function(e){return r["a"].get("user",{params:{id:e}})},add:function(e){return r["a"].post("user",e)},update:function(e){return r["a"].put("user",e)},delete:function(e){return r["a"].delete("user",{params:{id:e}})},deleteAll:function(e){return r["a"].delete("user/deleteall",{params:{ids:e}})},getPageList:function(e){return r["a"].get("user/pagelist",{params:e})}};t["a"]=s},cc5e:function(e,t,a){"use strict";var r=a("365c"),s={get:function(e){return r["a"].get("role",{params:{id:e}})},add:function(e){return r["a"].post("role",e)},update:function(e){return r["a"].put("role",e)},delete:function(e){return r["a"].delete("role",{params:{id:e}})},deleteAll:function(e){return r["a"].delete("role/deleteall",{params:{ids:e}})},getPageList:function(e){return r["a"].get("role/pagelist",{params:e})},getList:function(e){return r["a"].get("role/list",{params:e})}};t["a"]=s}}]);