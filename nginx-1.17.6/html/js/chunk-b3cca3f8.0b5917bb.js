(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b3cca3f8"],{"0feb":function(e,t,n){"use strict";var s=n("365c"),r={get:function(e){return s["a"].get("permission",{params:{id:e}})},add:function(e){return s["a"].post("permission",e)},update:function(e){return s["a"].put("permission",e)},delete:function(e){return s["a"].delete("permission",{params:{id:e}})},deleteAll:function(e){return s["a"].delete("permission/deleteall",{params:{ids:e}})},getPageList:function(e){return s["a"].get("permission/pagelist",{params:e})},getList:function(e){return s["a"].get("permission/list",{params:e})},getPermissionIdsByRoleId:function(e){return s["a"].get("permission/permissionidsbyroleid",{params:{roleId:e}})},getPermissionListByUserId:function(e){return s["a"].get("permission/permissionlistbyuserid",{params:{userId:e}})},assignPermission:function(e){return s["a"].post("permission/assign",e)}};t["a"]=r},"365c":function(e,t,n){"use strict";n("a481");var s=n("bc3a"),r=n.n(s),i=n("3786"),a=n("41cb"),o=n("c0d6"),c=n("a026"),u="",d={baseURL:u+"/api"},l=r.a.create(d),f=r.a.create(),m=o["a"];l.interceptors.request.use((function(e){var t=new Date,n=new Date(Date.parse(m.state.tokenExpire));return m.state.token&&t<n&&m.state.tokenExpire&&(e.headers.Authorization="Bearer "+m.state.token),p(),e}),(function(e){return Promise.reject(e)})),l.interceptors.response.use((function(e){return e}),(function(e){var t=e.config;if("ECONNABORTED"==e.code&&-1!=e.message.indexOf("timeout")&&!t._retry)return c["default"].prototype.$message({message:"请求超时！",type:"error"}),t._retry=!0,null;if(e.response){if(401==e.response.status){var n=new Date,s=new Date(Date.parse(window.localStorage.refreshtime));if(window.localStorage.refreshtime&&n<=s)return i["a"].refreshToken({token:window.localStorage.Token}).then((function(t){if(t.success){c["default"].prototype.$message({message:"refreshToken success! loading data...",type:"success"}),o["a"].commit("saveToken",t.token);var n=new Date,s=new Date(n.setSeconds(n.getSeconds()+t.expires_in));return o["a"].commit("saveTokenExpire",s),e.config.__isRetryRequest=!0,e.config.headers.Authorization="Bearer "+t.token,r()(e.config)}g()}));g()}if(403==e.response.status)return c["default"].prototype.$message({message:"失败！该操作无权限",type:"error"}),null}return""}));var p=function(){var e=new Date,t=window.localStorage.refreshtime?new Date(window.localStorage.refreshtime):new Date(-1),n=new Date(Date.parse(window.localStorage.TokenExpire)),s=1;t>=e?(t=e>n?e:n,t.setMinutes(t.getMinutes()+s),window.localStorage.refreshtime=t):window.localStorage.refreshtime=new Date(-1)},g=function(){o["a"].commit("saveToken",""),o["a"].commit("saveTokenExpire",""),o["a"].commit("saveTagsData",""),window.localStorage.removeItem("user"),window.localStorage.removeItem("NavigationBar"),a["a"].replace({path:"/login",query:{redirect:a["a"].currentRoute.fullPath}}),window.location.reload()},h={instance:function(){return l},baseInstance:function(){return f},get:function(e,t){return new Promise((function(n,s){l.get(e,t).then((function(e){n(e)})).catch((function(e){s(e)}))}))},post:function(e,t){return new Promise((function(n,s){l.post(e,t).then((function(e){n(e)})).catch((function(e){s(e)}))}))},put:function(e,t){return new Promise((function(n,s){l.put(e,t).then((function(e){n(e)})).catch((function(e){s(e)}))}))},delete:function(e,t){return new Promise((function(n,s){l.delete(e,t).then((function(e){n(e)})).catch((function(e){s(e)}))}))}};t["a"]=h},3786:function(e,t,n){"use strict";var s=n("365c"),r={getToken:function(e){return s["a"].get("auth/Token",e)},refreshToken:function(e){return s["a"].get("auth/RefreshToken",e)}};t["a"]=r},8577:function(e,t,n){"use strict";n.r(t);var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[n("div",{staticClass:"crumbs"},[n("el-breadcrumb",{attrs:{separator:"/"}},[n("el-breadcrumb-item",[n("i",{staticClass:"el-icon-lx-calendar"}),e._v(" 角色管理")]),n("el-breadcrumb-item",[e._v("分配权限")])],1)],1),n("div",{staticClass:"container"},[n("div",{staticClass:"form-box"},[n("el-tree",{ref:"tree",attrs:{data:e.permissionTreeData,"show-checkbox":"","node-key":"id","default-expand-all":"","expand-on-click-node":!0,"check-strictly":!0},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.node,r=t.data;return n("span",{staticClass:"custom-tree-node"},[n("span",[e._v(e._s(s.label))]),n("span",e._l(r.btns,(function(t){return n("el-checkbox",{key:t.value,attrs:{label:t.label,checked:e.isChecked(t.value)},on:{change:function(n){return e.checkboxChange(t.value)}}})})),1)])}}])}),n("div",{staticStyle:{padding:"50px 0 20px 20px"}},[n("el-button",{attrs:{type:"primary"},on:{click:e.saveAssign}},[e._v("保 存")])],1)],1)])])},r=[],i=(n("5df3"),n("ac6a"),n("0feb")),a={data:function(){return{permissionList:[],permissionTreeData:[],roleId:0,loading:!1,assignBtns:[],assignBtnIds:[]}},computed:{},methods:{isChecked:function(e){var t=!1;return this.assignBtns.length>0&&this.assignBtns.forEach((function(n){n.Id==e&&(t=!0)})),t},checkboxChange:function(e){var t=this.assignBtnIds.indexOf(e);t>-1?this.assignBtnIds.splice(t,1):this.assignBtnIds.push(e)},getPermissionList:function(e){var t=this,n=[];n.push(i["a"].getPermissionIdsByRoleId(e)),n.push(i["a"].getList({})),Promise.all(n).then((function(e){var n=e[0].data;t.$refs.tree.setCheckedKeys(n.data.PermissionIds),n.data.AssignBtns&&(t.assignBtns=n.data.AssignBtns,t.assignBtnIds=t.assignBtns.map((function(e){return e.Id})));var s=e[1].data;if(s.success){if(t.permissionList=s.data,0==t.permissionList.length)return;t.permissionTreeData=t.permissionList.filter((function(e){return 0==e.ParentId||null==e.ParentId})).map((function(e){return{id:e.Id,label:e.Name}})),t.permissionTreeData.forEach((function(e,n){e.btns=t.permissionList.filter((function(t){return t.IsButton&&t.ParentId==e.id})).map((function(e){return{value:e.Id,label:e.Name}})),t.groupPermission(e)}))}else t.$message({message:"加载菜单数据失败",type:"error"})})).catch((function(e){t.$message({message:"加载菜单数据失败",type:"error"})}))},groupPermission:function(e){var t=this,n=this.permissionList.filter((function(t){return t.ParentId==e.id&&!t.IsButton})).map((function(e){return{id:e.Id,label:e.Name}}));if(0==n.length)return null;n.forEach((function(s,r){s.btns=t.permissionList.filter((function(e){return e.IsButton&&e.ParentId==s.id})).map((function(e){return{value:e.Id,label:e.Name}})),e.children=n,t.groupPermission(s)}))},getPermissionIds:function(e){var t=this;i["a"].getPermissionIdsByRoleId(e).then((function(e){var n=e.data;n.success&&(t.$refs.tree.setCheckedKeys(n.data.PermissionIds),n.data.AssignBtns&&(t.assignBtns=n.data.AssignBtns,t.assignBtnIds=t.assignBtns.map((function(e){return e.Id}))))}))},saveAssign:function(){var e=this,t=e.$refs.tree.getCheckedKeys();e.assignBtnIds.length>0&&(t=t.concat(e.assignBtnIds)),e.roleId>0&&t.length>0?i["a"].assignPermission({roleId:e.roleId,permissionIds:t}).then((function(t){var n=t.data;n.success?(e.$message({message:n.msg,type:"success"}),e.getPermissionIds(e.roleId).then((function(t){e.$refs.tree.setCheckedKeys(t.data.data.PermissionIds),e.assignBtns=t.data.data.AssignBtns,e.$message({message:"数据更新成功",type:"success"})}))):e.$message({message:n.msg,type:"error"})})):e.$message({message:"参数错误",type:"error"})},handleMenuCheckChange:function(e,t,n){var s=this;if(t){var r=e.parentId;this.$refs.tree.setChecked(r,!0,!1)}else null!=e.children&&e.children.forEach((function(e){s.$refs.tree.setChecked(e.id,!1,!1)}))},checkAll:function(){var e=this.permissionList.map((function(e){return e.Id}));this.$refs.tree.setCheckedKeys(e)},resetChecked:function(){this.$refs.tree.setCheckedKeys([])},checkAllMenu:function(e,t){var n=this;e.forEach((function(e){t.push(e),e.children&&n.checkAllMenu(e.children,t)}))}},mounted:function(){},created:function(){var e=parseInt(this.$route.params.id);e>0&&(this.roleId=e,this.getPermissionList(e))}},o=a,c=(n("c7bb"),n("2877")),u=Object(c["a"])(o,s,r,!1,null,null,null);t["default"]=u.exports},c7bb:function(e,t,n){"use strict";var s=n("dae1"),r=n.n(s);r.a},dae1:function(e,t,n){}}]);